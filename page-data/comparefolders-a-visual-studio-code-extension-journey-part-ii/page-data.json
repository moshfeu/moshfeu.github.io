{"componentChunkName":"component---src-components-post-js","path":"/comparefolders-a-visual-studio-code-extension-journey-part-ii/","result":{"data":{"site":{"siteMetadata":{"title":"Moshe Feuchtwanger","social":[{"name":"twitter","url":"https://twitter.com/moshfeu"},{"name":"github","url":"https://github.com/moshfeu"},{"name":"linkedin","url":"https://www.linkedin.com/in/moshfeu/"},{"name":"stackoverflow","url":"https://stackoverflow.com/users/863110/mosh-feu"},{"name":"visualstudiocode","url":"https://marketplace.visualstudio.com/publishers/moshfeu"}]}},"mdx":{"id":"67683d05-0999-524f-9d8d-f8e7955865ce","excerpt":"In the  last post , we talked about the plugin, the requirements and the motivations.\nLike promised, the post will includes an explanation…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"comparefolders-a-visual-studio-code-extension-journey-part-ii\",\n  \"date\": \"2019-09-12T20:34:07.523Z\",\n  \"author\": \"Mosh Feu\",\n  \"title\": \"CompareFolders — a Visual Studio Code extension journey — Part II\",\n  \"image\": \"1qZSZkynXPE_QMtb_iS4xLQ.jpeg\",\n  \"images\": [\"1qZSZkynXPE_QMtb_iS4xLQ.jpeg\", \"1by_B-fz0zpp-qXXxUyVjlA.png\"],\n  \"tags\": [\"vscode\", \"vscode-extension\", \"how-to\", \"open-source\"],\n  \"keywords\": [\"vscode\", \"vscode-extension\", \"how-to\", \"open-source\"],\n  \"canonical\": \"https://moshfeu.medium.com/comparefolders-a-visual-studio-code-extension-journey-part-ii-dfe4d249219e\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/@moshfeu/comparefolders-visual-studio-code-extension-journey-intro-b540a0539629\"\n  }), \"last post\"), \", we talked about the plugin, the requirements and the motivations.\\nLike promised, the post will includes an explanation about the product challenge and how to solve it.\"), mdx(\"h2\", null, \"The Challenge\"), mdx(\"p\", null, \"In order to let the users to compare folders, we need to allow them to run a command that will open the \\u201Cchoose a folder\\u201D dialog so they could choose a folder from their file system. Once they chosen, the plugin will run the code that compare them. So:\"), mdx(\"h2\", null, \"How to add a command to commands palette in vscode extension?\"), mdx(\"p\", null, \"Basically it well explained in the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://code.visualstudio.com/api/get-started/extension-anatomy\"\n  }), \"docs\"), \" so let\\u2019s do it quick\"), mdx(\"p\", null, \"First, we need to add a entity in \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" root\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"\\\"contributes\\\": {\\n  \\\"commands\\\": [\\n    {\\n      \\\"command\\\": \\\"extension.compare\\\",\\n      \\\"title\\\": \\\"Compare Folders\\\"\\n    }\\n  ]\\n},\\n\")), mdx(\"p\", null, \"Second, the command need to be registered during the plugin activation (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"extension.ts\"), \").\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ts\"\n  }), \"export function activate(context: vscode.ExtensionContext) {\\n  let disposable = vscode.commands.registerCommand('extension.compare', () => {\\n    compare(); // we'll get this later\\n  });\\n\\n  context.subscriptions.push(disposable);\\n}\\n\")), mdx(\"p\", null, \"Notice that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"command\"), \" in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" and the one which sent to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"registerCommand\"), \" have to be the same.\"), mdx(\"p\", null, \"Now, when users will open the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://code.visualstudio.com/docs/getstarted/userinterface#_command-palette\"\n  }), \"command palette\"), \" they will get this (if not, they will need to start typing\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"646px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/2c1c5695a042281b1668fe82b598c099/27524/1by_B-fz0zpp-qXXxUyVjlA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"28.333333333333332%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAAzklEQVQY033Ou07EMBAFUP//R1AANVRICCSgoKBYAfF4/Eg2azvaSHlgO6lQFq2W8XYURDrFvbrFDHND8kNwQ2zGRGwXXJ9RaL6mdWzrW9QVR7P5BDSVqe3mg78XgqP+Xg7rmB3nZpx8n2/aLvpxdj39kuou7oZ5Hbv1x+tyuarI4cb+XJbLhcme2iPGEw8n+B97qafHKtzpcG/C6y49byOFhzK8uSTaWezP2gz2fyphEoSWslSKKKm0UlSVQATkXJCiAIKocgUEgXCeEOUvBtg+QWUpd1YAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Compare Folders command in the command palette\",\n    \"title\": \"Compare Folders command in the command palette\",\n    \"src\": \"/static/2c1c5695a042281b1668fe82b598c099/27524/1by_B-fz0zpp-qXXxUyVjlA.png\",\n    \"srcSet\": [\"/static/2c1c5695a042281b1668fe82b598c099/5a46d/1by_B-fz0zpp-qXXxUyVjlA.png 300w\", \"/static/2c1c5695a042281b1668fe82b598c099/0a47e/1by_B-fz0zpp-qXXxUyVjlA.png 600w\", \"/static/2c1c5695a042281b1668fe82b598c099/27524/1by_B-fz0zpp-qXXxUyVjlA.png 646w\"],\n    \"sizes\": \"(max-width: 646px) 100vw, 646px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Compare Folders command in the command palette\")), mdx(\"p\", null, \"Now that plugin have an \\u201Centry point\\u201D followed by a user interaction, we need another piece in the puzzle, let the users to choose a folder.\"), mdx(\"h2\", null, \"How to let users to choose a folder in vscode extension?\"), mdx(\"p\", null, \"The API for opening the file system is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"window.showOpenDialog\"), \" (\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://code.visualstudio.com/api/references/vscode-api#2294\"\n  }), \"docs\"), \"). It takes an \\u201Coptions\\u201D object as single argument and returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Thenable\"), \" (Something like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Promise\"), \"). By default it allows to choose only files. That can be changes by passing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"canSelectFolder: true\"), \" in the options object.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ts\"\n  }), \"const options: vscode.OpenDialogOptions = {\\n  canSelectMany: false,\\n  canSelectFolders: true,\\n};\\n\\nvscode.window.showOpenDialog(options).then(fileUri => {\\n  if (fileUri && fileUri[0]) {\\n    console.log(fileUri[0].fsPath);\\n  }\\n});\\n\")), mdx(\"p\", null, \"The last part for this post is how to, eventually, compare the folders and display the diff in a diff view?\"), mdx(\"h2\", null, \"How to compare folders by content?\"), mdx(\"p\", null, \"The extension uses the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.npmjs.com/package/dir-compare\"\n  }), \"dir-compare\"), \" package for this. Here is the code that does it (with comments)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ts\"\n  }), \"// open folder picker dialog to choose first folder\\nconst folder1 = await openFolder();\\n\\n// open folder picker dialog to choose second folder\\nconst folder2 = await openFolder();\\n\\n// compare folders by contents\\nconst options = {compareContent: true};\\n\\n// do the compare\\nconst res = compareSync(\\n  folder1,\\n  folder2,\\n  options\\n);\\n\\n// get the diffs\\nconst { diffSet = [] } = res;\\n\\n// diffSet contains all the files and filter only the not equals files and map them to pairs of Uris\\nconst diffs = diffSet\\n  .filter(diff => diff.state === 'distinct')\\n  .map(diff => [`${diff.path1}/${diff.name1}`, `${diff.path2}/${diff.name2}`]);\\n\")), mdx(\"p\", null, \"And finally\"), mdx(\"h2\", null, \"How to ask vscode to display a \\u201Ccompare\\u201D view?\"), mdx(\"p\", null, \"Using the vscode command \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vscode.diff\"), \" the extension opens a diff view with the contents of both of the files.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ts\"\n  }), \"await vscode.commands.executeCommand('vscode.diff',\\n  vscode.Uri.file(diffs[0][0]),\\n  vscode.Uri.file(diffs[0][1]),\\n  'My great Diff'\\n);\\n\")), mdx(\"p\", null, \"Notice that currently, it takes only the first pair. This code meant to simplify the explanation and to show only how to use the package and the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"diff\"), \" API. In the next post, I\\u2019ll show the real approach that present a list of all the changes and let the user to pick them one by one.\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/moshfeu/vscode-compare-folders/tree/d970aaad87dcb3b5c31997c23e807ef0f53ddcdc\"\n  }), \"Source code for this post\")), mdx(\"p\", null, \"Have something to say? I\\u2019ll love to \\uD83D\\uDC42\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"comparefolders-a-visual-studio-code-extension-journey-part-ii/","frontmatter":{"canonical":"https://moshfeu.medium.com/comparefolders-a-visual-studio-code-extension-journey-part-ii-dfe4d249219e","title":"CompareFolders — a Visual Studio Code extension journey — Part II","subtitle":null,"keywords":["vscode","vscode-extension","how-to","open-source"],"tags":["vscode","vscode-extension","how-to","open-source"],"date":"September 12, 2019","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAF786mSSQP/xAAZEAACAwEAAAAAAAAAAAAAAAABAgADERL/2gAIAQEAAQUCqrXORHrXqpjCxxmO/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAAAAMRD/2gAIAQEABj8CTKqv/8QAGBABAAMBAAAAAAAAAAAAAAAAAQARMSD/2gAIAQEAAT8hBiLmOE7l3H//2gAMAwEAAgADAAAAENQ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8QR//EABgQAQEBAQEAAAAAAAAAAAAAAAEAESFx/9oACAEBAAE/EAjhZoOHkFYBADqLwp2yv//Z","aspectRatio":1.7783505154639174,"src":"/static/2ee40dd09c13f3585379b01bf4fff934/a674a/1qZSZkynXPE_QMtb_iS4xLQ.jpg","srcSet":"/static/2ee40dd09c13f3585379b01bf4fff934/862d9/1qZSZkynXPE_QMtb_iS4xLQ.jpg 345w,\n/static/2ee40dd09c13f3585379b01bf4fff934/32c8c/1qZSZkynXPE_QMtb_iS4xLQ.jpg 690w,\n/static/2ee40dd09c13f3585379b01bf4fff934/a674a/1qZSZkynXPE_QMtb_iS4xLQ.jpg 1380w,\n/static/2ee40dd09c13f3585379b01bf4fff934/4e1b9/1qZSZkynXPE_QMtb_iS4xLQ.jpg 1844w","sizes":"(max-width: 1380px) 100vw, 1380px"}}}},"childMdxBlogPost":{"imageAlt":null,"imageCaptionLink":null,"imageCaptionText":null,"socialImage":null}},"previous":{"__typename":"MdxBlogPost","id":"29c20ea7-9412-5b34-b1c6-eec7f17acb28","excerpt":"This post meant to introduce the journey of the Visual Studio Code (“vscode”) plugin  CompareFolders . The post is (will be) part of a…","slug":"/comparefolders-visual-studio-code-extension-journey-intro/","title":"CompareFolders Visual Studio Code extension journey — Intro","date":"September 12, 2019"},"next":{"__typename":"MdxBlogPost","id":"e89fcf39-137b-56c2-816c-b830ba2573fe","excerpt":"In the  last post , we talked about how to add a command to the commands palette so the user could interact with the plugin via commands. In…","slug":"/he-activity-comparefolders-a-visual-studio-code-extension-journey-part-ii/","title":"CompareFolders — a Visual Studio Code extension journey — Part III","date":"September 19, 2019"}},"pageContext":{"id":"63c805fb-3f29-5961-98f6-e6725a88efad","previousId":"29c20ea7-9412-5b34-b1c6-eec7f17acb28","nextId":"e89fcf39-137b-56c2-816c-b830ba2573fe","maxWidth":1380,"slug":"comparefolders-a-visual-studio-code-extension-journey-part-ii"}},"staticQueryHashes":["2744905544","3090755652","4064581832","511549514","764694655"]}