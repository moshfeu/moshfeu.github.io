{"componentChunkName":"component---src-components-post-js","path":"/build-your-own-analytics-tool-on-corvid-by-wix/","result":{"data":{"site":{"siteMetadata":{"title":"Moshe Feuchtwanger","social":[{"name":"twitter","url":"https://twitter.com/moshfeu"},{"name":"github","url":"https://github.com/moshfeu"},{"name":"linkedin","url":"https://www.linkedin.com/in/moshfeu/"},{"name":"stackoverflow","url":"https://stackoverflow.com/users/863110/mosh-feu"},{"name":"visualstudiocode","url":"https://marketplace.visualstudio.com/publishers/moshfeu"}]}},"mdx":{"id":"908fb54b-6318-59af-897c-c09dc15fe9a7","excerpt":"Disclaimer: I’m a Frontend developer at Wix, that’s right. But this post written as a result of my experience as a “regular” user. I even…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"build-your-own-analytics-tool-on-corvid-by-wix\",\n  \"date\": \"2020-09-24T18:39:36.487Z\",\n  \"author\": \"Mosh Feu\",\n  \"title\": \"Build Your Own Analytics Tool on Corvid by Wix\",\n  \"subtitle\": \"Photo by Lukas from Pexels\",\n  \"image\": \"1Zfxe6RzmbGj6aiUq3V7SSA.jpeg\",\n  \"images\": [\"1Zfxe6RzmbGj6aiUq3V7SSA.jpeg\", \"1tmJ3tHQGLwXZ4oNHoqG2fg.png\", \"1SOm7yvZtUtNJmXH5VkeEHA.png\", \"11lH2lnOpgoGDTzvNgCtSEQ.jpeg\", \"1Vr05wRrYTy64LyAdl1x-sg.png\", \"1GjLlNxfqhTIzS615wK-w1A.gif\"],\n  \"tags\": [\"wix\", \"corvid\", \"javascript\", \"serverless\"],\n  \"keywords\": [\"wix\", \"corvid\", \"javascript\", \"serverless\"],\n  \"canonical\": \"https://medium.com/swlh/build-your-own-analytics-tool-on-corvid-by-wix-cd12ae76d291\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Disclaimer: I\\u2019m a Frontend developer at Wix, that\\u2019s right. But this post written as a result of my experience as a \\u201Cregular\\u201D user. I even used a non Wix account to build it and honestly, even if 1000 of you will build an app on Wix, I won\\u2019t profit from it directly in any way \\uD83D\\uDE00\"), mdx(\"p\", null, \"So why I wrote this post? I really enjoyed building it. It\\u2019s simple (well, most of the parts), zero configuration, and of course, it\\u2019s free. Ah, and you don\\u2019t need to leave the browser \\u2014 100% cloud.\"), mdx(\"p\", null, \"It all started when I published a package on npm and wanted to track the page views. Long time ago, I used \\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://hits.dwyl.com/dwyl/start-here\"\n  }), \"hits\"), \"\\u201D for the same purpose but now I thought that it can be interesting to build something like that by myself. Also, hits just gives the number of page views. I though it can be nicer to have more segmented data, by time, refers, geo location etc.\"), mdx(\"h2\", null, \"What\\u2019s needed for an Analytics app?\"), mdx(\"p\", null, \"Every analytics tool has at least the basic components:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Embedded resource in the host site \\u2014 script, image (pixel) etc. which send a request with relevant information about the user, the browser, ip, geo etc.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Server to handle the requests.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Database to store the records.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Client app to display the data usually in a graphic way \\u2014 tables, graphs, maps etc.\"))), mdx(\"p\", null, \"Another nice to have components:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Monitoring\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Environments \\u2014 staging / production for both the server and the database\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Authentication \\u2014 only allowed user can have access to the data\"))), mdx(\"p\", null, \"All those component is part of Corvid and Wix echo-system out of the box with zero configurations.\"), mdx(\"h2\", null, \"Let\\u2019s Start\"), mdx(\"p\", null, \"I won\\u2019t explain how to create a website on Wix (I recommend to start with the \\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://editor.wix.com/html/editor/web/renderer/new?siteId=cbf36d3a-49d0-41c2-9482-1bb58d5fdda3&metaSiteId=a573279f-ae6f-46d1-8556-7c93ae9b2c84\"\n  }), \"blank template\"), \"\\u201D), it\\u2019s straightforward, well documented and take few minutes. It takes another second to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://support.wix.com/en/article/getting-started-with-corvid-by-wix\"\n  }), \"enable Corvid\"), \" on the website.\\nAlso, I won\\u2019t explain how to do things which already well documented. Instead, I added links so you can get all the information you need from them. (If I missed some, please let me know).\"), mdx(\"p\", null, \"Now let\\u2019s implement the components we talked about few lines ago.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Embedded Resource\")), mdx(\"p\", null, \"There are several ways to do it. I choose to expose an endpoint which returns an SVG and just before that, add a record in the database. This way, I show a nice SVG badge in the package page and at the same time, it sends a request back to the server. I know I didn\\u2019t invent the wheel, \\u201Chits\\u201D does exactly the same, but I\\u2019m just about to show you how much it\\u2019s easy in Corvid.\"), mdx(\"p\", null, \"Corvid hosts the code of both of the sides \\u2014 the client and the server, just like a nodejs based website which uses JavaScript both on the client and the server side.\"), mdx(\"p\", null, \"In order to expose an endpoint for external sources, we need to write a special server code (located under the \\u201CBackend\\u201D folder)? Why it\\u2019s special? Because usually the server code is accessible only internally to the website\\u2019s pages.\\nIn order to create this special module, the file name should be called\\n\\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.wix.com/corvid/reference/wix-http-functions\"\n  }), \"http-functions.js\"), \"\\u201D.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"472px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/d5438d40e185b8407edae96f5b217ee2/3c5de/1tmJ3tHQGLwXZ4oNHoqG2fg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"102.66666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsSAAALEgHS3X78AAACV0lEQVQ4y5VUW2+iQBSev+6r793+BdN90sTdaNMa1i7Wtsa6LrEKqKAgIDPDIAJycw+ybdyu6eXky3BmMmfOd26g/UHSg2RZlmb7jwuq1WqVSuXrxQWsqqoWpxhjRVEopRvPc8JsvU01N9lGrx9G5+fnpVLpy9lZuVyWJKk4JYR0u91v9bo8nVnb/YLFop04QW58/ACKomgH2O38IIA1StI4SSCE/N5fSUHLd+lrQRYmmDprTAH2i0Ic08a6aR2wLrCychiWDVit7clURcJY/v0kLXRjOBJnqrZcmcpSl2Yq3AAGQCWK4mOE4U7VVg7bGBZGI1G+7Q3k+UIYiwPhqfdLGI4m/H1/qRsF81dJArbqcmUTStgGFUf/3dlD3SD0Ezi8B2U1bYpgTyj1/QDyBCSLTADh5FD3N2BhiihzZVlqNpvVarXX652kelLWxEHHHbb/jOTGfhDKsiwIwmAw0DTtI56zA3LjrR9AP4H9cDg0DONznuGTJEUKc5/QZO/y93ZZEGU2YYhtvMd+v16v3+TS/sFxjDlFFp7b858o4nQ/p4nGYgs7CC5B2EEYPlfyRMRwDoUsAEXEXuQGSe4ZBrh9129wnYf+4/fm5X2vf8Pf/ux0r1pcm78FvXP3AC3NPJ+4HnU9WPkpE02PUAeBn7GsDEaTNSbjiTRTVEVdqEttri5mykKUp2NRctzNNgg9PygwMbemG2LKYCRjiCqOY9/3QQFeMAoQB0zB+9mmbDOfz6+ur1utFvwMeJ7nOA5S12g0dF1/ydzpOh93GLgt9KJ4b3cLGP8B08mmvW5aSF4AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"http-functions.js to expose an endpoint for external calls\",\n    \"title\": \"http-functions.js to expose an endpoint for external calls\",\n    \"src\": \"/static/d5438d40e185b8407edae96f5b217ee2/3c5de/1tmJ3tHQGLwXZ4oNHoqG2fg.png\",\n    \"srcSet\": [\"/static/d5438d40e185b8407edae96f5b217ee2/5a46d/1tmJ3tHQGLwXZ4oNHoqG2fg.png 300w\", \"/static/d5438d40e185b8407edae96f5b217ee2/3c5de/1tmJ3tHQGLwXZ4oNHoqG2fg.png 472w\"],\n    \"sizes\": \"(max-width: 472px) 100vw, 472px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"http-functions.js to expose an endpoint for external calls\")), mdx(\"p\", null, \"Following the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.wix.com/corvid/reference/wix-http-functions/introduction\"\n  }), \"methods naming convention\"), \", I created the \\u201Cview\\u201D endpoint which accepts \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GET\"), \" requests and respond with SVG \", \"[1]\", \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import {ok} from 'wix-http-functions';\\n\\nexport async function get_view(request) {\\n  const svg = `<svg>....</svg>`;\\n  const response = {\\n    headers: {\\n      'Content-Type': 'image/svg+xml',\\n      'Content-Length': svg.length,\\n    },\\n    body: svg,\\n  };\\n  return ok(response);\\n}\\n\")), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://moshfeudev.wixsite.com/shield/_functions/view_demo\"\n  }), \"Demo\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Saving the Data\")), mdx(\"p\", null, \"Corvid offers a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://support.wix.com/en/article/corvid-working-with-wix-data\"\n  }), \"built-in database\"), \" (\\u201CContent Manager\\u201D) with a strong yet easy API, called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"wixData\"), \".\"), mdx(\"p\", null, \"First thing is creating a table (\\u201Ccollection\\u201D) \\u2014 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"views\"), \" and add the following columns: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"headers\"), \" (as Text), \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"refrer\"), \" (as Text). This will be enough for the basic app, you can add more of course (I added \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"project\"), \" so I could embed as many resources as I want).\"), mdx(\"p\", null, \"It\\u2019s a good time to mention that, when you create a collection, pay attention to the permission section (\\u201CWhat\\u2019s the collection for?\\u201D). Start with set \\u201Canyone\\u201D to all the methods and customize it as you go.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"300px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/b7fb8b5be252165b0a647146fd901eb5/5a46d/1SOm7yvZtUtNJmXH5VkeEHA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"125%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsSAAALEgHS3X78AAAC0UlEQVQ4y41UTW/TQBD1j6rKDUSRqkJb/gAHxIUzf4NLQYAEqIKSVNxAIASH3iraUoGoaOAALaR2bG/sOOTDXu/6cx3erts0bVLR0fNovN7nnZk3trbw6PtspTtfac298BYr3rUjLFSln3k2hmVn5ql1edmdf1jTLt77cWWlM1/1Zp5711fbVyve7Io3V/EWqzK48NidHsWT1vQDY2ppb+p+/dLSrvb+q7Flpet19lHn6wd8oxFvKmwY0m+byTg+mfEXp/iwY2hOkwxEmjAqEp7FbFAUg/9ZofYQQjTDtHsB02232e7arU7AIjwQxZkAMc5EVAxM09YapoXdaZblucAFD4iiENJJK4NyvQQ2gyLJP/frlMddn/aCsBuE8B2fGsQ1Ha/RbAGW0zZIq9OXG0pgMyi/9uva77qeZHnIIxbFPE5K+CELQuZTpgIOQrkhVKAsSjLxRzc0m5AkzTiece7TUHHCkEUh5yHjfQpWPLFhIEoy3u22O/2AolhZlVCmypOdEOIUOcNDkG2imZaFtMEcP+Esy0sykWS7zARWdhv+CCKTKuSy+SPIVS5l2s2Qxz0/8IOw71PUjCwCFE8ZPIphPDp1MrQ7JFs2hiS0Xa/bD86ZdpSKbjywbNUwNSR5+b5yOgs1ScXwVs7ccdrYOzyZgJekKUAhF5SUskUIICwCLELLyVI1LClV62+36wcgRHJI4jiBpfCIsYienep2UZINi+AEr4PC2TlrlioMyUOp1HCUXpyMi1ETQ6mQdpSkch4ZR+YYR2jmh1IqLPZ8iluIPblmNExK5XgdJVUxycbTTg8nzCbICh1Gt8/+dQzEkWbHDZOzrX4GqpQTX/woYPKzjXOmQCOpnGXZmuM4ONGkBc0mnal8LAZ31ujNN/6tt/7td/6NV72726nrOtrOt13iensG0W2n2ZwMmzivPxvVTX11U3+5pVc3DtZqzd1a7R/Z0m4vx15h2wAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Permissions settings\",\n    \"title\": \"Permissions settings\",\n    \"src\": \"/static/b7fb8b5be252165b0a647146fd901eb5/5a46d/1SOm7yvZtUtNJmXH5VkeEHA.png\",\n    \"srcSet\": [\"/static/b7fb8b5be252165b0a647146fd901eb5/5a46d/1SOm7yvZtUtNJmXH5VkeEHA.png 300w\"],\n    \"sizes\": \"(max-width: 300px) 100vw, 300px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Permissions settings\")), mdx(\"p\", null, \"Now we can modify the endpoint code to extract the relevant information from the request and save it in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"views\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"try {\\n  await wixData.insert('views', {\\n    referer,\\n    headers: JSON.stringify(headers),\\n  })\\n} catch (error) {\\n  console.log(error);\\n}\\n\")), mdx(\"p\", null, \"(You can see the logs in the \\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://support.wix.com/en/article/corvid-about-site-monitoring\"\n  }), \"Site Monitoring\"), \"\\u201D)\"), mdx(\"p\", null, \"The nice thing about the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"headers\"), \" is that they contain geo location information out of the box, so later, we can show a geo location visualization.\"), mdx(\"p\", null, \"Now, when we have all the data, we want to show it visually.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Client App\")), mdx(\"p\", null, \"This step should be straightforward, right? After all, Wix is a UI builder before anything. The good news is that for some components, it\\u2019s true. For example, it\\u2019s very easy to create a table and connect it to the database. It can be done even without coding. But when it comes to more sophisticated visualization elements such as graphs, charts, maps etc. there are no built-in options nor external apps to connect the data to the elements.\\nSo there is no easy way (As fat as I know) but there is a way shown in this \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.wix.com/corvid/example/create-a-custom-chart\"\n  }), \"tutorial\"), \" and that\\u2019s how I did it, but I have to admit that it\\u2019s not that convenient. I hope it will be changed in the future.\"), mdx(\"p\", null, \"In a nutshell, the challenge is that even though we can \\u201Cinteract\\u201D with components through Corvid code, we are not interacting with the DOM itself but with a special isolated DOM \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"like\"), \". As a result, we can\\u2019t use JavaScript libraries which depends on interacting with the actual DOM.\\nThe only (free) way to have access to a DOM is by adding an \\u201CHTML iframe\\u201D component. But here is the catch, we can\\u2019t inject data into the iframe directly because the communication between the page and the iframe has to be through post messages.\"), mdx(\"p\", null, \"So here is the flow starts on page ready.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Get the data from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"views\"), \" table.\\n1.1 In parallel, render the iframe (handle by Wix).\\n1.2. Establish an event listener to get messages from the iframe.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"The iframe initiating a chart library, establish an event listener to get messages from the page, and posts a message to the parent saying \\u201CI\\u2019m ready\\u201D.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"The page (waits for the data if needed and) posts a message back with the data.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"The iframe gets the data and draw the chart accordingly.\"))), mdx(\"p\", null, \"If I missed you, maybe a diagram will help:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"461px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/7a7eee88a236a80b72f3e86586fb2d8a/9f170/11lH2lnOpgoGDTzvNgCtSEQ.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"97.66666666666669%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHuaxoqiUShf//EABYQAAMAAAAAAAAAAAAAAAAAABAgQf/aAAgBAQABBQI1f//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABsQAQACAwEBAAAAAAAAAAAAAAEAERBBUSEx/9oACAEBAAE/Id1uCdJRyLp9gHPcVZArH//aAAwDAQACAAMAAAAQo8jA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAQACAgMAAAAAAAAAAAAAAREAQSExEFFh/9oACAEBAAE/EBFhIPWIZR+ZbTAqeHfFzvEbXWBDJg8jrAEPH//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"The diagram shows the flow and the communication between the page and the iframe\",\n    \"title\": \"The diagram shows the flow and the communication between the page and the iframe\",\n    \"src\": \"/static/7a7eee88a236a80b72f3e86586fb2d8a/9f170/11lH2lnOpgoGDTzvNgCtSEQ.jpg\",\n    \"srcSet\": [\"/static/7a7eee88a236a80b72f3e86586fb2d8a/f93b5/11lH2lnOpgoGDTzvNgCtSEQ.jpg 300w\", \"/static/7a7eee88a236a80b72f3e86586fb2d8a/9f170/11lH2lnOpgoGDTzvNgCtSEQ.jpg 461w\"],\n    \"sizes\": \"(max-width: 461px) 100vw, 461px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"The diagram shows the flow and the communication between the page and the iframe\")), mdx(\"p\", null, \"In this project, I\\u2019m using Google\\u2019s \\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developers.google.com/chart/interactive/docs/gallery/linechart\"\n  }), \"Line Chart\"), \"\\u201D so we need to fit the data to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"[DataTable\"), \"](\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developers.google.com/chart/interactive/docs/datatables_dataviews#emptytable\"\n  }), \"https://developers.google.com/chart/interactive/docs/datatables_dataviews#emptytable\"), \") format.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The iframe\\u2019s code\")), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"300px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/69c369ba366927507677543742922102/5a46d/1Vr05wRrYTy64LyAdl1x-sg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"127.33333333333331%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsSAAALEgHS3X78AAACr0lEQVQ4y41Uy2oUQRSdf3HlIn6DCwmYhZqV8Sf8AFEkSEDETcClEk0UkpUEdRNJFuLShahomJjJTKbf1e+uV1fXw9vdCZlxOtHiUNyuqnMfpy+3F+PqyC+OvMT2oxRzUkoq1BTKGZxe9bhQtuMMBof7/X4YxcYYabQy5n/Q45WuNFAMbJXSUpuLIZSpTu2aLJSuGvyTKZswapp8YSipWlRSlZUaJhURYFQQrCaXTSadAL8oSkfH9shyXNc9sKMnn5LP++7b7Q9xVoBgWkIetUwNjDyzG1CcJRFKwiCNA4xx382jnHgo5EL2lNJfLfxgB93fQe3eGg8/nmB5N1rejR/tRfd2ove/clBWtZWD2vDx+kt8edVd2EDX1tD8S3T9Fbr6IrjyzGvgz61ac49/zD09uLTy8+67QCt5pjY42v6eLKwHS1vh7c1waTO8s1Xj1hu02ODmhn9jbby47sw/t1b2QuCekVkpg5T6hXQy4WRVAzCEmwsPUFQBUQHVzW78jDFQ3JySCZcFYVLKOE4IIYwxSmlrpFkGtplYjHM6SU6pTAsKB0KaKE5cH4Vx4qPI8QLGeN2tqu4KAMhE2DS5jcyEDrEsigLaGxNSEJLlRSmEmV50lkwZQ1h+cwXOMxRGWmtzzuogZ5jOvpv0ALaE7GfJoF6BqVQqxxTuGC8JZQ04JgwTiqH0suyOPLYsP0AKyAWUSkGSrMDgDlOGGy9gg9du8mA0djwfLmzXHQxHlu30f8OZNRge244HTi+qOcUsybFScjS2gQUig2BCVBxyLUvofN3MiW4yzKSc1FmFcQzRPB+Z89cs+URtKGw4GvcPB9BYjcL6v8htZCgPOmRsu+0Y7Cb/1Z7QWwUr4RR05qIqodpS1BFmwTmGvyaVnJxh4Av+NgFw0QLcdwJeTo63P0dNhbG7fBcZAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Luckily, we don’t need to host the iframe’s code anywhere, we can set its code directly in the Editor [2].\",\n    \"title\": \"Luckily, we don’t need to host the iframe’s code anywhere, we can set its code directly in the Editor [2].\",\n    \"src\": \"/static/69c369ba366927507677543742922102/5a46d/1Vr05wRrYTy64LyAdl1x-sg.png\",\n    \"srcSet\": [\"/static/69c369ba366927507677543742922102/5a46d/1Vr05wRrYTy64LyAdl1x-sg.png 300w\"],\n    \"sizes\": \"(max-width: 300px) 100vw, 300px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Luckily, we don\\u2019t need to host the iframe\\u2019s code anywhere, we can set its code directly in the Editor \", \"[2]\", \".\")), mdx(\"p\", null, \"Here is the code (notice the \\u201Cloader\\u201D \\uD83D\\uDE09)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-html\"\n  }), \"<!DOCTYPE html>\\n<html>\\n  <body>\\n    <script\\n      type=\\\"text/javascript\\\"\\n      src=\\\"https://www.gstatic.com/charts/loader.js\\\"\\n    ></script>\\n    <div id=\\\"chart_div\\\"></div>\\n    <siv id=\\\"loading\\\">Loading...</siv>\\n\\n    <script>\\n      // Initiate google charts\\n      google.charts.load('current', { packages: ['corechart', 'line'] });\\n      google.charts.setOnLoadCallback(init);\\n\\n      function onEvent(details) {\\n        const data = new google.visualization.DataTable();\\n        data.addColumn('date', 'day');\\n        data.addColumn('number', 'Page Views');\\n\\n        data.addRows([...details]);\\n\\n        const options = {\\n          pointSize: 5,\\n          hAxis: {\\n            title: 'Time',\\n            format: 'dd/MM/yy',\\n          },\\n          vAxis: {\\n            title: 'Popularity',\\n          },\\n        };\\n\\n        const chart = new google.visualization.LineChart(\\n          document.getElementById('chart_div')\\n        );\\n\\n        chart.draw(data, options);\\n      }\\n\\n      function init() {\\n        // Listen to messages from the page\\n        window.addEventListener('message', ({ data: { type, data } }) => {\\n          if (type === 'graph') {\\n            onEvent(data);\\n            document.querySelector('#loading').style.display = 'none';\\n          }\\n        });\\n      }\\n      // Tell the page the iframe's ready\\n      window.parent.postMessage({ type: 'ready' }, '*');\\n    </script>\\n  </body>\\n</html>\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The page code\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"import wixData from 'wix-data';\\nimport _ from 'lodash';\\n\\n$w.onReady(function () {\\n  const getDataPromise = wixData.query('views').find();\\n\\n  // The iframe is ready\\n  $w('#html1').onMessage(async ({ data }) => {\\n    if (data.type === 'ready') {\\n      const results = await getDataPromise;\\n\\n      // Group the rows by date and map it to DataTable format\\n      const chartData = Object.entries(\\n        _.groupBy(results.items, (item) => item._createdDate.toDateString())\\n      ).map(([date, entities]) => [new Date(date), entities.length]);\\n\\n      // Post back to the page with the data\\n      $w('#html1').postMessage({\\n        type: 'graph',\\n        data: chartData,\\n      });\\n    }\\n  });\\n});\\n\")), mdx(\"p\", null, \"And the result\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/46e3d09505a0bc6b3284e57599d5d2b5/1GjLlNxfqhTIzS615wK-w1A.gif\",\n    \"alt\": \"How it looks on Chrome\"\n  })), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"How it looks on Chrome\")), mdx(\"p\", null, \"If you don\\u2019t want this page to be visible to everyone, \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://support.wix.com/en/article/limiting-pages-on-your-site-to-specific-members-member-roles\"\n  }), \"you can limit it\"), \".\"), mdx(\"p\", null, \"This is it basically. From this point you can take it to wherever your imagination can take you \\u2014 hit maps, different categorization, comparing timestamp etc. If you need my help with that, leave a comment or reach out.\"), mdx(\"p\", null, \"If you want to get a copy of this website, let me know and I\\u2019ll send a copy to your Wix account.\"), mdx(\"p\", null, \"And usually, if you have questions or ideas about how to improve this post (or my other posts), leave a comment or say hi \\uD83D\\uDC4B\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.linkedin.com/in/moshfeu/\"\n  }), mdx(\"strong\", {\n    parentName: \"a\"\n  }, \"Moshe Feuchtwanger - Frontend Developer - Wix.com | LinkedIn\"), mdx(\"em\", {\n    parentName: \"a\"\n  }, \"View Moshe Feuchtwanger's profile on LinkedIn, the world's largest professional community. Moshe has 7 jobs listed on\\u2026\"), \"www.linkedin.com\")), mdx(\"p\", null, \"[1]\", \" The endpoint can also respond with another image types such as png, jpg etc. encoded by base64\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const img = Buffer.from('iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQYV2PgjOr/DwADVAHy2H3MYgAAAABJRU5ErkJggg==', 'base64')\\nconst response = {\\n  headers: {\\n    'Content-Type': 'image/png',\\n    'Content-Length': img.length\\n  },\\n  body: img\\n};\\n\\nreturn ok(response);\\n\")), mdx(\"p\", null, \"[2]\", \" Yah, it\\u2019s a bit annoying to edit the code in the Editor, copy / paste it in your favorite code editor and then copy / paste it back.\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"build-your-own-analytics-tool-on-corvid-by-wix/","frontmatter":{"canonical":"https://medium.com/swlh/build-your-own-analytics-tool-on-corvid-by-wix-cd12ae76d291","title":"Build Your Own Analytics Tool on Corvid by Wix","subtitle":"Photo by Lukas from Pexels","keywords":["wix","corvid","javascript","serverless"],"tags":["wix","corvid","javascript","serverless"],"date":"September 24, 2020","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAYZxdOUUI//EABoQAQADAAMAAAAAAAAAAAAAAAMBAhIEETP/2gAIAQEAAQUCIq7UjpW+dEm+Uk9y/r//xAAWEQADAAAAAAAAAAAAAAAAAAAQESH/2gAIAQMBAT8BVH//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECETEhEv/aAAgBAQAGPwKMXeF9XR+XaMwoZ//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExQVGx/9oACAEBAAE/IdKylzAXAtu8RAvJY3FRInjZgYVr5P/aAAwDAQACAAMAAAAQTz//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/EFgiw//EABcRAQADAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8QXLh//8QAGhABAQEBAQEBAAAAAAAAAAAAAREhADFRYf/aAAgBAQABPxAFqSOxH6cdoQRQnc5sZOuXgTBPBt/eYtSFnuF5hUDwYeO//9k=","aspectRatio":1.513157894736842,"src":"/static/8587ab67f6c6fd632c984f86fbe536ed/ec6c5/1Zfxe6RzmbGj6aiUq3V7SSA.jpg","srcSet":"/static/8587ab67f6c6fd632c984f86fbe536ed/862d9/1Zfxe6RzmbGj6aiUq3V7SSA.jpg 345w,\n/static/8587ab67f6c6fd632c984f86fbe536ed/32c8c/1Zfxe6RzmbGj6aiUq3V7SSA.jpg 690w,\n/static/8587ab67f6c6fd632c984f86fbe536ed/ec6c5/1Zfxe6RzmbGj6aiUq3V7SSA.jpg 1280w","sizes":"(max-width: 1280px) 100vw, 1280px"}}}},"childMdxBlogPost":{"imageAlt":null,"imageCaptionLink":null,"imageCaptionText":null,"socialImage":null}},"previous":{"__typename":"MdxBlogPost","id":"c121c7a7-b820-5227-b337-6c01071620e4","excerpt":"In the previous post I talked about the purpose of the project (Make an HTML5 game controlled by “external controller”), the final product…","slug":"/how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-2/","title":"How to build an HTML5 game’s controller with Arduino, NodeJS and socket.io — Part 2","date":"April 25, 2020"},"next":{"__typename":"MdxBlogPost","id":"3695a60a-d843-5067-8ba7-5d0106839017","excerpt":"I'm a big fan of \"css only\" approaches ( For example ] and I'm sure I'm not alone. That's why I was so exsiting to get to know the  pointer…","slug":"/show-tooltip-on-pointer-events-none-element/","title":"Show tooltip on pointer-events none element","date":"September 02, 2022"}},"pageContext":{"id":"2dd5238d-cfeb-58ff-a521-c54d1f539672","previousId":"c121c7a7-b820-5227-b337-6c01071620e4","nextId":"3695a60a-d843-5067-8ba7-5d0106839017","maxWidth":1380,"slug":"build-your-own-analytics-tool-on-corvid-by-wix"}},"staticQueryHashes":["2744905544","3090755652","4064581832","511549514","764694655"]}