{"componentChunkName":"component---src-components-post-js","path":"/how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-1/","result":{"data":{"site":{"siteMetadata":{"title":"Moshe Feuchtwanger","social":[{"name":"twitter","url":"https://twitter.com/moshfeu"},{"name":"github","url":"https://github.com/moshfeu"},{"name":"linkedin","url":"https://www.linkedin.com/in/moshfeu/"},{"name":"stackoverflow","url":"https://stackoverflow.com/users/863110/mosh-feu"},{"name":"visualstudiocode","url":"https://marketplace.visualstudio.com/publishers/moshfeu"}]}},"mdx":{"id":"c34018db-4a88-553e-a83c-1fad242b54bf","excerpt":"During the Covid 19 “vacation” I wanted to create a project for my 12 years old sun. He likes computer games and he likes Arduino. I wanted…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-1\",\n  \"date\": \"2020-04-17T15:05:54.819Z\",\n  \"author\": \"Mosh Feu\",\n  \"title\": \"How to build an HTML5 game’s controller with Arduino, NodeJS and socket.io — Part 1\",\n  \"subtitle\": \"Photo by Daniel Andrade on Unsplash\",\n  \"image\": \"0v-ekW736B6QzNRQT.jpg\",\n  \"images\": [\"0v-ekW736B6QzNRQT.jpg\", \"1bfXyAsxD4ULJgpS2oYdKfA.gif\", \"1O4N3f5CKhVjcS2DNVwBHgw.gif\"],\n  \"tags\": [\"arduino\", \"socketio\", \"nodejs\", \"games-consoles\"],\n  \"keywords\": [\"arduino\", \"socketio\", \"nodejs\", \"games-consoles\"],\n  \"canonical\": \"https://moshfeu.medium.com/how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-1-c5067647ca51\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"During the Covid 19 \\u201Cvacation\\u201D I wanted to create a project for my 12 years old sun. He likes computer games and he likes Arduino.\"), mdx(\"p\", null, \"I wanted to focus on the connectivity and the Arduino part but not on developing the game itself. So the plan is to take an existing html5 game which controlled by keyboard and add the ability to control it from an external \\u201Ccontroller\\u201D which will be connected through a server to the game host using socket.\"), mdx(\"p\", null, \"Like any project, I like to do small steps. Do one simple step, make sure it\\u2019s working and \\u201Ccomplicate\\u201D it a bit more. There are the steps:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"First, control it from a different browser window using the same keyboard keys.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Then, control it from a mobile phone on the same network of course.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Finally, control it through an nodemcu esp8266 controller which has a builtin wifi module to make it easier to establish a connection.\"))), mdx(\"p\", null, \"I was looking for a very simple light weight html5 game. As less dependencies as possible. The chosen game\\u2026 \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/cykod/AlienInvasion\"\n  }, \"https://github.com/cykod/AlienInvasion\"), \" (it\\u2019s an old one, I know)\"), mdx(\"h2\", null, \"Installing dependencies\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"yarn add express socket.io @types/socket @types/express\\n\")), mdx(\"p\", null, \"I like types..\"), mdx(\"h2\", null, \"Control the game from a different window\"), mdx(\"p\", null, \"Currently, the user can control the game using the keyboard. The idea is to \\u201Csend\\u201D the event from the controller to the game. While it\\u2019s not possible to send the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"actual\"), \" event over socket, I\\u2019ll send only \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"keyCode\"), \" to the server. Those will be enough for dispatching the event in the game.\"), mdx(\"p\", null, \"Let\\u2019s start from the server. To establish a socket, as the post\\u2019s title mention, I\\u2019m using NodeJS and socket.io. The server also will serve the \\u201Cstatics\\u201D \\u2014 html and js files.\"), mdx(\"p\", null, \"Since I\\u2019m new in socket.io, I\\u2019m following the \\u201C\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://socket.io/get-started/chat/\"\n  }, \"Getting Started\"), \"\\u201D guide.\\nFirst thing is to run an express server\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const express = require('express');\\nconst app = express();\\nconst http = require('http').createServer(app);\\nconst io = require('socket.io')(http);\\n\\napp.use(express.static(__dirname));\\n\\napp.get('/', (req, res) => {\\n  res.sendFile(__dirname + '/index.html');\\n});\\n\\nio.on('connection', (socket) => {\\n  console.log('a user connected');\\n});\\n\\nhttp.listen(3000, () => {\\n  console.log('listening on *:3000');\\n});\\n\")), mdx(\"p\", null, \"This is the very basic code to establish a socket connection.\"), mdx(\"p\", null, \"Now, the server should listen to events through socket from the controller and \\u201Ctransmit\\u201D to the game.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"io.on('connection', (socket) => {\\n  socket.on('event', message => {\\n    socket.broadcast.emit('event', message);\\n  });\\n});\\n\")), mdx(\"p\", null, \"Notice that I\\u2019m using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"socket.broadcast.emit\"), \" . This way it will send the events \\u201Cto all clients except sender\\u201D.\"), mdx(\"p\", null, \"Next thing is connecting the clients. The first connection is very simple:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const socket = io();\\n\")), mdx(\"p\", null, \"I\\u2019m adding 2 files to the project (except the server code and package.json and.. well you get my point)\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"controller.html\"), \" \\u2014 to demonstrate.. well.. the controller (which will be the Arduino eventually).\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"remotely.js\"), \" \\u2014 for taking care of the \\u201Cremote\\u201D layer. Will be added to the game file.\"))), mdx(\"p\", null, \"Currently, I want to make sure that both of the clients are connected over socket.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"controller.html\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-html\"\n  }, \"<button>Start</button>\\n<script>\\n  const socket = io();\\n  document.querySelector('button').addEventListener('click', () => {\\n    socket.emit('key', 'start');\\n  });\\n</script>\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"remotely.js\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"const socket = io();\\nsocket.on('key', console.log);\\n\")), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/8472a3f7db76c910cfbce5556a8a226c/1bfXyAsxD4ULJgpS2oYdKfA.gif\",\n    \"alt\": \"Click on “start” in the controller, create’s a log in the game\"\n  }), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Click on \\u201Cstart\\u201D in the controller, create\\u2019s a log in the game\")), mdx(\"p\", null, \"Next step will be to actually \\u201Ctransmit\\u201D the \\u201Cevents\\u201D from the controller to the game\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"controller.html\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"function isRelevantKey(key) {\\n  return ['ArrowRight', 'ArrowLeft', ' '].includes(key);\\n}\\n\\n['keydown', 'keyup'].forEach(type => {\\n  window.addEventListener(type, ({key, keyCode}) => {\\n    if (isRelevantKey(key)) {\\n      socket.emit('event', {type, key, keyCode});\\n    }\\n  });\\n});\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"remotely.js\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"socket.on('event', ({type, key, keyCode}) => {\\n  const evt = new KeyboardEvent(type, {\\n    key,\\n    keyCode\\n  });\\n  window.dispatchEvent(evt);\\n});\\n\")), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/e4f39b926d00f637f9ea1e748fc40919/1O4N3f5CKhVjcS2DNVwBHgw.gif\",\n    \"alt\": \"Pressing on the keyboard while controller.html is in focus, moves the mothership in the game window\"\n  }), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Pressing on the keyboard while controller.html is in focus, moves the mothership in the game window\")), mdx(\"p\", null, \"In the next post I\\u2019ll start the second step \\u2014 turn my mobile phone to a controller and then will come the interesting part. To make it more interesting, I\\u2019ll add try to add a \\u201Cjoystick\\u201D UI to it. I hope to find a ready one \\uD83E\\uDD1E\"), mdx(\"p\", null, \"Feel free to review the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/moshfeu/AlienInvasion\"\n  }, \"source code\"), \" and the relevant \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/moshfeu/AlienInvasion/commit/f6772b09d48f06b277398e0065644e26073eb208\"\n  }, \"commit\"), \" on Github.\"), mdx(\"p\", null, \"Have something to say? I\\u2019d love to \\uD83D\\uDC42\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://twitter.com/moshfeu\"\n  }, \"https://twitter.com/moshfeu\")));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-1/","frontmatter":{"canonical":"https://moshfeu.medium.com/how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-1-c5067647ca51","title":"How to build an HTML5 game’s controller with Arduino, NodeJS and socket.io — Part 1","subtitle":"Photo by Daniel Andrade on Unsplash","keywords":["arduino","socketio","nodejs","games-consoles"],"tags":["arduino","socketio","nodejs","games-consoles"],"date":"April 17, 2020","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACA//EABQBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAASJzzQnxI0//xAAaEAACAgMAAAAAAAAAAAAAAAABAgAiAxES/9oACAEBAAEFAkAJ7iPVtLiVrCf/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8BTW0L/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPwGxU1n/xAAcEAABBAMBAAAAAAAAAAAAAAAAAQIRIRAiQVH/2gAIAQEABj8Cm5IYW0TW16L7j//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQWFR/9oACAEBAAE/IXC02/sMApXcABp7OMkBtLMQtzEt+NT/2gAMAwEAAgADAAAAEDz/AP/EABgRAAMBAQAAAAAAAAAAAAAAAAABEcHR/9oACAEDAQE/EGwokJi4f//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESHB/9oACAECAQE/EAaUjZ7f/8QAHBABAAMAAwEBAAAAAAAAAAAAAQARIUFRYTGR/9oACAEBAAE/EAW0lZ9Wn5cuWA0dewUXdQr7sLonCNi7hweRFDAEGdYcREiHItuf/9k=","aspectRatio":1.5,"src":"/static/ddb616af07bc62333e83c537c2b20521/a674a/0v-ekW736B6QzNRQT.jpg","srcSet":"/static/ddb616af07bc62333e83c537c2b20521/862d9/0v-ekW736B6QzNRQT.jpg 345w,\n/static/ddb616af07bc62333e83c537c2b20521/32c8c/0v-ekW736B6QzNRQT.jpg 690w,\n/static/ddb616af07bc62333e83c537c2b20521/a674a/0v-ekW736B6QzNRQT.jpg 1380w,\n/static/ddb616af07bc62333e83c537c2b20521/9edab/0v-ekW736B6QzNRQT.jpg 2070w,\n/static/ddb616af07bc62333e83c537c2b20521/cf519/0v-ekW736B6QzNRQT.jpg 2760w,\n/static/ddb616af07bc62333e83c537c2b20521/d2452/0v-ekW736B6QzNRQT.jpg 4000w","sizes":"(max-width: 1380px) 100vw, 1380px"}}}},"childMdxBlogPost":{"imageAlt":null,"imageCaptionLink":null,"imageCaptionText":null,"socialImage":null}},"previous":{"__typename":"MdxBlogPost","id":"d4e1756f-854c-5f92-ac3a-c0b222382fa5","excerpt":"Highlight the code Jekyll supplys a tag called  highlight . It can accept some parameters - what's the code language and whether show lines…","slug":"/how-to-post-code-snippet-and-run-it/","title":"How to post code snippet and run it","date":"March 30, 2020"},"next":{"__typename":"MdxBlogPost","id":"c121c7a7-b820-5227-b337-6c01071620e4","excerpt":"In the previous post I talked about the purpose of the project (Make an HTML5 game controlled by “external controller”), the final product…","slug":"/how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-2/","title":"How to build an HTML5 game’s controller with Arduino, NodeJS and socket.io — Part 2","date":"April 25, 2020"}},"pageContext":{"id":"171315cb-5bcf-5370-a4ab-cb5f3716bcff","previousId":"d4e1756f-854c-5f92-ac3a-c0b222382fa5","nextId":"c121c7a7-b820-5227-b337-6c01071620e4","maxWidth":1380,"slug":"how-to-build-an-html5-games-controller-with-arduino-nodejs-and-socket-io-part-1"}},"staticQueryHashes":["2744905544","3090755652","4064581832","511549514","764694655"]}