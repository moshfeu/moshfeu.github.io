{"componentChunkName":"component---src-components-post-js","path":"/comparefolders-a-visual-studio-code-extension-journey-part-v/","result":{"data":{"site":{"siteMetadata":{"title":"Moshe Feuchtwanger","social":[{"name":"twitter","url":"https://twitter.com/moshfeu"},{"name":"github","url":"https://github.com/moshfeu"},{"name":"linkedin","url":"https://www.linkedin.com/in/moshfeu/"},{"name":"stackoverflow","url":"https://stackoverflow.com/users/863110/mosh-feu"},{"name":"visualstudiocode","url":"https://marketplace.visualstudio.com/publishers/moshfeu"}]}},"mdx":{"id":"6207caa7-ece5-5f86-973e-7a223972ec15","excerpt":"In the  last post , we talked about how to add a button to a panel’s top bar — either in the “more” menu or as icon button in the top bar…","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"comparefolders-a-visual-studio-code-extension-journey-part-v\",\n  \"date\": \"2019-10-06T05:50:28.194Z\",\n  \"author\": \"Mosh Feu\",\n  \"title\": \"CompareFolders — a Visual Studio Code extension journey — Part V\",\n  \"image\": \"0WLT5eGWMd5Sloyre.jpeg\",\n  \"images\": [\"0WLT5eGWMd5Sloyre.jpeg\", \"1rwXn02dUYwuzmk0e5d9KcA.png\", \"1oCKpmprnWTK4LstdApAeRQ.gif\"],\n  \"tags\": [\"vscode\", \"vscode-extension\", \"how-to\", \"open-source\"],\n  \"keywords\": [\"vscode\", \"vscode-extension\", \"how-to\", \"open-source\"],\n  \"canonical\": \"https://moshfeu.medium.com/comparefolders-a-visual-studio-code-extension-journey-part-v-614014a81efb\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://medium.com/@moshfeu/comparefolders-a-visual-studio-code-extension-journey-part-iv-a26264e841a3?source=friends_link&sk=e21b42e8c4de1a447fcac3464b37ebf8\"\n  }, \"last post\"), \", we talked about how to add a button to a panel\\u2019s top bar \\u2014 either in the \\u201Cmore\\u201D menu or as icon button in the top bar itself. Also we learned how to use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"_onDidChangeTreeData.fire()\"), \" in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TreeDataProvider\"), \" class to refresh the view.\"), mdx(\"p\", null, \"Like promised, the post will includes an explanation about the product challenge and how to solve it.\"), mdx(\"h2\", null, \"The challenge\"), mdx(\"p\", null, \"The extension is supporting (currently) only comparing between a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://stackoverflow.com/a/57134632/863110\"\n  }, \"single workspace folder\"), \" (or just a folder), and a folder that the user chosen. Which means that if there is not folder in the workspace (just open a new window of vscode) or if it has more than one folder the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://medium.com/@moshfeu/he-activity-comparefolders-a-visual-studio-code-extension-journey-part-ii-77e0467a12f6#d5a5\"\n  }, \"activity icon\"), \" and the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://medium.com/@moshfeu/he-activity-comparefolders-a-visual-studio-code-extension-journey-part-ii-77e0467a12f6#3f30\"\n  }, \"view\"), \" shouldn\\u2019t be visible and vice-versa.\"), mdx(\"p\", null, \"The challenge is even bigger because this can be changed without closing the window, therefor, vscode will not re-activate the extension. Which means that the extension need to \\u201Clisten\\u201D to this change.\"), mdx(\"p\", null, \"So, let\\u2019s break it to some steps.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Now the extension need to be activate just when the vscode window is opened but not only when the extension\\u2019s view is visible. That\\u2019s because we need to check if the workspace has exactly one folder \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"before\"), \" it shows the view. In order to do this, the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"[activationEvents\"), \"](\", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://code.visualstudio.com/api/references/activation-events\"\n  }, \"https://code.visualstudio.com/api/references/activation-events\"), \") now should be \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"*\"))), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1200px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/d9871beff4c17c937d8460316b970b41/46115/1rwXn02dUYwuzmk0e5d9KcA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"10.999999999999998%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbklEQVQI1w3HOxKEIAwAUO9/OJulWGfWFSR8FCJBJLHU5s28oTkokyrfD6qRJkVmuUAzaHGm+xDjkWtOlP1uwP9c0NbNfrfhROQyNCQJIG4Vv74yLN3+O8zd6nuLfNVMaSsptCMzolS8Kwohvy0P2oxtkQotA+sAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"1rwXn02dUYwuzmk0e5d9KcA\",\n    \"title\": \"1rwXn02dUYwuzmk0e5d9KcA\",\n    \"src\": \"/static/d9871beff4c17c937d8460316b970b41/c1b63/1rwXn02dUYwuzmk0e5d9KcA.png\",\n    \"srcSet\": [\"/static/d9871beff4c17c937d8460316b970b41/5a46d/1rwXn02dUYwuzmk0e5d9KcA.png 300w\", \"/static/d9871beff4c17c937d8460316b970b41/0a47e/1rwXn02dUYwuzmk0e5d9KcA.png 600w\", \"/static/d9871beff4c17c937d8460316b970b41/c1b63/1rwXn02dUYwuzmk0e5d9KcA.png 1200w\", \"/static/d9871beff4c17c937d8460316b970b41/46115/1rwXn02dUYwuzmk0e5d9KcA.png 1290w\"],\n    \"sizes\": \"(max-width: 1200px) 100vw, 1200px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"ol\", {\n    \"start\": 2\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"To show / hide a view based on condition, a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"view\"), \" has a configuration property called \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"[when\"), \"](\", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://code.visualstudio.com/api/extension-guides/tree-view#tree-view\"\n  }, \"https://code.visualstudio.com/api/extension-guides/tree-view#tree-view\"), \"). For example:\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"\\\"contributes\\\": {\\n  \\\"views\\\": {\\n    \\\"package-explorer\\\": [\\n      {\\n        \\\"id\\\": \\\"nodeDependencies\\\",\\n        \\\"name\\\": \\\"Node Dependencies\\\",\\n        \\\"when\\\": \\\"explorer\\\"\\n      }\\n    ]\\n  }\\n}\\n\")), mdx(\"p\", null, \"So the view will be visible only when the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"explorer\"), \" panel is visible.\"), mdx(\"p\", null, \"But what if we need a custom when clause? In our case, if the workspace has exactly one folder? (If you already know the answer, good for you \\uD83D\\uDE00)\"), mdx(\"h2\", null, \"How to create a custom \", mdx(\"inlineCode\", {\n    parentName: \"h2\"\n  }, \"when\"), \" clause?\"), mdx(\"p\", null, \"Or, how to show / hide views, command menus and all the other UI components that have the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when\"), \" option in \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"package.json\"), \"?\"), mdx(\"p\", null, \"In order to understand that, we need to understand what is the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"editorLangId \"), \"or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isInDiffEditor\"), \", or any other clauses in the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://code.visualstudio.com/docs/getstarted/keybindings#_contexts\"\n  }, \"list\"), \".\"), mdx(\"p\", null, \"Well, vscode has context variables. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isInDiffEditor\"), \" is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" when the current editor is.. well.. diff editor (the side by side one, yes?) and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \" in all other cases.\"), mdx(\"p\", null, \"The extension has the power to create its own context variable. Well, don\\u2019t search this API in the docs.. It\\u2019s not there. Yah, I know.. There is an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/Microsoft/vscode/issues/46445\"\n  }, \"open issue on Github\"), \" about that.\"), mdx(\"p\", null, \"Anyway, there is an API to create a custom context variable\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"commands.executeCommand('setContext', '[variableName]', [variableValue]);\\n\")), mdx(\"p\", null, \"In our case, the extension needs to check both on its \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"activation\"), \" and when the workspace folders changed (by listening to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"workspace.onDidChangeWorkspaceFolders)\"), \" if the workspace has exactly one folder. If so, the extension will set a context variable \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"workspaceHasOneFolder\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \" if not. Then, we could use that variable in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"package.json\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"\\\"views\\\": {\\n  \\\"foldersCompare\\\": [\\n    {\\n      \\\"id\\\": \\\"foldersCompareAppService\\\",\\n      \\\"name\\\": \\\"Compare\\\",\\n      \\\"when\\\": \\\"workspaceHasOneFolder\\\"\\n    }\\n  ]\\n}\\n\")), mdx(\"p\", null, \"and Voil\\xE0\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/72f411bf7c69c20abfd1a67fa4835000/1oCKpmprnWTK4LstdApAeRQ.gif\",\n    \"alt\": \"Show activity bar icon only if workspace has only one folder\"\n  }), mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Show activity bar icon only if workspace has only one folder\")), mdx(\"p\", null, \"After we saw all this I\\u2019ve to admit, I cheated.. there is an appropriate \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when\"), \" clause \\u2014 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"workspaceFolderCount\"), \" so the condition will be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"workspaceFolderCount == 1\"), \" but I wanted to show how to deal with custom context variable. I hope to find a different \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"real\"), \" example.\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/moshfeu/vscode-compare-folders/commit/26233117ae445c25a2bcf2e427e0b3991923ca7b\"\n  }, \"Source code for this post\"), \" (short this time)\"), mdx(\"p\", null, \"Have something to say? I\\u2019ll love to \\uD83D\\uDC42\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"comparefolders-a-visual-studio-code-extension-journey-part-v/","frontmatter":{"canonical":"https://moshfeu.medium.com/comparefolders-a-visual-studio-code-extension-journey-part-v-614014a81efb","title":"CompareFolders — a Visual Studio Code extension journey — Part V","subtitle":null,"keywords":["vscode","vscode-extension","how-to","open-source"],"tags":["vscode","vscode-extension","how-to","open-source"],"date":"October 06, 2019","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAGh+ZTJRGH/xAAZEAACAwEAAAAAAAAAAAAAAAABAgADERL/2gAIAQEAAQUCqRc5EeteqmMLHGY7/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhABAQEAAAAAAAAAAAAAAAAAADEQ/9oACAEBAAY/Akyqr//EABgQAQADAQAAAAAAAAAAAAAAAAEAETEg/9oACAEBAAE/IRYi5jgO5dx//9oADAMBAAIAAwAAABAUP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EEf/xAAYEAEBAQEBAAAAAAAAAAAAAAABABEhcf/aAAgBAQABPxAYgWYDh5a2AQcxReFO2V//2Q==","aspectRatio":1.7783505154639174,"src":"/static/aa969a2ba00985ac017e465f66572909/a674a/0WLT5eGWMd5Sloyre.jpg","srcSet":"/static/aa969a2ba00985ac017e465f66572909/862d9/0WLT5eGWMd5Sloyre.jpg 345w,\n/static/aa969a2ba00985ac017e465f66572909/32c8c/0WLT5eGWMd5Sloyre.jpg 690w,\n/static/aa969a2ba00985ac017e465f66572909/a674a/0WLT5eGWMd5Sloyre.jpg 1380w,\n/static/aa969a2ba00985ac017e465f66572909/4e1b9/0WLT5eGWMd5Sloyre.jpg 1844w","sizes":"(max-width: 1380px) 100vw, 1380px"}}}},"childMdxBlogPost":{"imageAlt":null,"imageCaptionLink":null,"imageCaptionText":null,"socialImage":null}},"previous":{"__typename":"MdxBlogPost","id":"d5e8c393-6600-52c4-bb2e-f925f0b99dd1","excerpt":"In the  last post , we talked about how to add an icon to the activity bar and “attach” a view to it. How to use  TreeDataProvider  to…","slug":"/comparefolders-a-visual-studio-code-extension-journey-part-iv/","title":"CompareFolders — a Visual Studio Code extension journey — Part IV","date":"September 29, 2019"},"next":{"__typename":"MdxBlogPost","id":"0ea0be3b-f7ae-5456-abdd-0ba141ec50fe","excerpt":"Highlight the code Jekyll supplys a tag called  highlight . It can accept some parameters - what's the code language and whether show lines…","slug":"/how-to-post-code-snippet-and-run-it/","title":"How to post code snippet and run it","date":"March 30, 2020"}},"pageContext":{"id":"98793d7a-849c-5b6b-8de8-6351484d701d","previousId":"d5e8c393-6600-52c4-bb2e-f925f0b99dd1","nextId":"0ea0be3b-f7ae-5456-abdd-0ba141ec50fe","maxWidth":1380,"slug":"comparefolders-a-visual-studio-code-extension-journey-part-v"}},"staticQueryHashes":["2744905544","3090755652","4064581832","511549514","764694655"]}